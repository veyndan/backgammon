@layer reset {
	*, ::before, ::after {
		box-sizing: border-box;
	}

	body {
		margin: 0;
	}
}

@layer typography {
	.typography-body-large-700 {
		font: 700 1.25em/1 system-ui;
	}

	.typography-body-medium-700 {
		font: 700 1.125em/1 system-ui;
	}

	.typography-body-small-700 {
		font: 700 .75em/1 system-ui;
	}

	.typography-label-large-700 {
		font: 700 .875em/1.43 system-ui;
	}

	.typography-label-small-700 {
		font: 700 .5em/1 system-ui;
	}

	.typography-label-small-400 {
		font: 400 .5em/1 system-ui;
	}
}

@layer palette {
	:root {
		--primary: light-dark(#a0d49b, #39693b);
		--on-primary: light-dark(#ffffff, #083910);
		--secondary: light-dark(#52634f, #b9ccb4);
		--on-secondary: light-dark(#ffffff, #253423);
		--tertiary: light-dark(#39656b, #a1ced4);
		--on-tertiary: light-dark(#ffffff, #00363b);
		--primary-container: light-dark(hsl(115.9 65.9% 82.7%), hsl(121.3 39.1% 22.5%));
		--on-primary-container: light-dark(#002105, #bbf0b5);
		--secondary-container: light-dark(#d5e8cf, #3b4b39);
		--on-secondary-container: light-dark(#101f10, #d5e8cf);
		--tertiary-container: light-dark(#bcebf1, #1f4d52);
		--on-tertiary-container: light-dark(#001f23, #bcebf1);
		--surface-dim: light-dark(#d7dbd3, #10140f);
		--surface: light-dark(hsl(84 55.6% 96.5%), hsl(108 14.3% 6.9%));
		--surface-bright: light-dark(#f7fbf1, #363a34);
		--surface-container-lowest: light-dark(#ffffff, #0b0f0a);
		--surface-container-low: light-dark(#f1f5ec, #181d17);
		--surface-container: light-dark(#ebefe6, #1c211b);
		--surface-container-high: light-dark(#e6e9e0, #272b25);
		--surface-container-highest: light-dark(#e0e4db, #323630);
		--on-surface: light-dark(#181d17, #e0e4db);
		--on-surface-variable: light-dark(#424940, #c2c9bd);
		--outline: light-dark(#72796f, #8c9388);
		--outline-variant: light-dark(#c2c9bd, #424940);
		--inverse-surface: light-dark(#2d322c, #e0e4db);
		--inverse-on-surface: light-dark(#eef2e9, #2d322c);
		--inverse-primary: light-dark(#9fd49c, #3b693a);
		--scrim: light-dark(#000000, #000000);
		--shadow: light-dark(#000000, #000000);
	}

	.surface {
		color: var(--on-surface);
		background: var(--surface);
	}
}

:root {
	--bar-width-unitless: 38;
	--checker-diameter-unitless: calc(var(--checker-radius-unitless) * 2);
	--checker-radius-unitless: 16;
	--checker-thickness-unitless: 5;
	--checkers-per-player: 15;
	--die-side-length-unitless: 36;
	--half-height-unitless: calc(var(--point-height-unitless) * 2 + var(--checker-diameter-unitless) * 2 + var(--die-side-length-unitless) + 24);
	--half-width-unitless: calc(var(--point-width-unitless) * 6);
	--hold-width-unitless: calc(var(--checker-diameter-unitless));
	--point-count: 24;
	--point-height-unitless: calc(var(--checker-diameter-unitless) * 4);
	--point-max: 24;
	--point-min: 1;
	--point-per-side: calc(var(--point-count) / 2);
	--point-width-unitless: var(--checker-diameter-unitless);

	--bar-width-length: calc(var(--bar-width-unitless) * .0625em);
	--checker-diameter-length: calc(var(--checker-diameter-unitless) * .0625em);
	--checker-radius-length: calc(var(--checker-radius-unitless) * .0625em);
	--checker-thickness-length: calc(var(--checker-thickness-unitless) * .0625em);
	--die-side-length-length: calc(var(--die-side-length-unitless) * .0625em);
	--half-height-length: calc(var(--half-height-unitless) * .0625em);
	--half-width-length: calc(var(--half-width-unitless) * .0625em);
	--hold-width-length: calc(var(--hold-width-unitless) * .0625em);

	color-scheme: light dark;
}

html {
	block-size: 100dvb;
	font: 16px/1.5 system-ui;
}

body {
	display: flex;
	flex-direction: column;
	gap: 8px;

	block-size: 100%;
	padding: 16px;

	& > :not(main) > * {
		margin-inline: auto;
		padding-inline: 1rem;
	}
}

header > nav {
	& > ul {
		display: flex;
		flex-wrap: wrap;
		gap: 1em;

		padding-inline: 0;

		font-weight: bold;
		list-style-type: none;

		& > li:first-child:has(> a[href="/index.html"]) {
			margin-inline-end: auto;
		}
	}

	a {
		&:any-link {
			color: LinkText;
		}

		&[aria-current="page"] {
			color: inherit;
			text-decoration: inherit;
		}
	}
}

button {
	cursor: pointer;

	&:disabled {
		cursor: not-allowed;
	}
}

[data-player="1"] {
	--player-current-checker-background: var(--surface-container-lowest);
	--player-current-checker-text-color: var(--on-surface);
}

[data-player="2"] {
	--player-current-checker-background: var(--on-surface);
	--player-current-checker-text-color: var(--surface-container-lowest);
}

main {
	min-block-size: 0;
	margin-block: auto;
}

.main {
	container-type: size;
	max-inline-size: 100%;
	max-block-size: 100%;
	margin-inline: auto;
}

.aspect-ratio-lock {
	display: grid;
	grid-template-rows: .75em auto .75em;
	gap: .5em;
	align-items: stretch;
	justify-content: center;

	inline-size: 100%;
	block-size: 100%;

	font-size: 3.5cqb;
}

#players {
	display: flex;
	gap: .5em;
	align-self: center;
}

#timer {
	display: flex;
	gap: .5em;
	align-items: center;
	align-self: center;

	padding-block: .25em;
	padding-inline: .875em;
	border-radius: .5em;

	background: var(--surface-container-high);

	& > #move {
		color: var(--secondary);
	}
}

#play-mode {
	gap: .375em;
	align-items: center;
	align-self: center;
	justify-items: start;

	block-size: 2em;
	padding-inline: 1em .8em;
	border: none;
	border-radius: 1em;

	color: var(--on-surface);

	appearance: base-select;
	background: var(--on-tertiary);

	&::picker-icon {
		/*content: "a"; TODO Convert this to the svg using a background: url(data-base64-of-svg) so we can animate rotation. */
		content: "";
		transition: 0.4s rotate;
	}

	&::picker(select) {
		inset-block-start: calc(anchor(outside) + .25em);
		inset-inline-start: anchor(self-start);

		border: .15em white solid;
		border-radius: .5em;

		color: var(--on-surface);

		appearance: base-select;
		background: var(--tertiary-container);
	}

	&:open::picker-icon {
		rotate: 180deg;
	}

	& > button > svg {
		inline-size: .75em;
		block-size: .75em;
		fill: currentColor;
	}

	& > option {
		gap: 1em;
		padding-block: 1em;
		padding-inline: 2em;

		&::checkmark {
			order: 1;
		}
	}
}

main[data-player="1"] #players > veyndan-player[data-player="1"],
main[data-player="2"] #players > veyndan-player[data-player="2"] {
	background: var(--primary-container);
}

main[data-player="2"]:has(#play-mode > option[value="opposite"]:checked) > .main > .aspect-ratio-lock > #controls > div {
	rotate: .5turn;

	&:first-of-type {
		grid-column: 5;
	}

	&:last-of-type {
		grid-column: 3;
	}
}

main:has(#play-mode > option[value="opposite"]:checked) {
	flex-direction: column;

	.main {
		aspect-ratio: 32 / 21;
	}

	.aspect-ratio-lock {
		grid-template-rows: .75em auto .75em;

		& > #board {
			& > .half {
				grid-row: 2;

				&#outer-board {
					grid-column: 3;
				}

				&#inner-board {
					grid-column: 5;
				}
			}

			& > .bar {
				grid-column: 4;
				grid-row: 2;
			}

			& > #sidebar {
				grid-column: 6;
				grid-row: 2;
			}
		}

		& > #controls {
			& > div {
				grid-row: 2;

				&:first-of-type {
					grid-column: 3;
				}

				&:last-of-type {
					grid-column: 5;
				}
			}
		}
	}

	#players {
		grid-column: 1;
		grid-row: 2;
		writing-mode: sideways-lr;
	}

	#timer {
		grid-column: 2;
		grid-row: 2;
		writing-mode: sideways-lr;
	}

	#play-mode {
		grid-column: 7;
		grid-row: 2;
		writing-mode: sideways-rl;

		& > button > svg {
			rotate: .25turn;
		}
	}
}

main:has(#play-mode > option[value="side-by-side"]:checked) {
	flex-direction: column;

	.main {
		aspect-ratio: 20 / 21;
	}

	.aspect-ratio-lock {
		grid-template-rows: .75em auto auto auto .75em;

		& > #board {
			& > .half {
				grid-row: 4;

				&#outer-board {
					grid-column: 2;
				}

				&#inner-board {
					grid-column: 4;
				}
			}

			& > .bar {
				grid-column: 3;
				grid-row: 4;
			}

			& > #sidebar {
				grid-column: 5;
				grid-row: 4;
			}
		}

		& > #controls {
			& > div {
				grid-row: 4;

				&:first-of-type {
					grid-column: 2;
				}

				&:last-of-type {
					grid-column: 4;
				}
			}
		}
	}

	#players {
		grid-column: 2 / span 3;
		grid-row: 2;
		justify-self: center;
	}

	#timer {
		grid-column: 2 / span 3;
		grid-row: 3;
		justify-self: center;
	}

	#play-mode {
		grid-column: 1;
		grid-row: 4;
		writing-mode: sideways-lr;

		& > button > svg {
			rotate: .75turn;
		}
	}

	&[data-player="1"] > .main > .aspect-ratio-lock > #controls > div {
		&:first-of-type {
			grid-column: 4;
		}

		&:last-of-type {
			grid-column: 2;
		}
	}
}

.hold {
	--checker-radius-length: .875em;
	--checker-diameter-length: calc(var(--checker-radius-length) * 2);
	--gap: .0625em;
	--padding: .125em;

	display: flex;
	flex-direction: row-reverse;
	gap: var(--gap);

	inline-size: calc(var(--checkers-per-player) * var(--checker-thickness-length) + 2 * var(--padding) + (var(--checkers-per-player) - 1) * var(--gap));
	block-size: var(--hold-width-length);
	padding: var(--padding);
	border-radius: .25em;

	background: var(--secondary-container);
}

#doubling-cube-face {
	--die-side-length-length: 1.75em;

	display: flex;
	align-items: center;
	justify-content: center;

	inline-size: var(--die-side-length-length);
	block-size: var(--die-side-length-length);
	border-radius: .25em;

	color: var(--on-secondary-container);

	background: var(--secondary-container);
}

main {
/*	overflow: auto;*/
/*	display: flex;*/
/*	flex: 1;*/
/*	align-items: center;*/
/*	justify-content: center;*/

/*	& > svg {*/
/*		touch-action: none;*/
/*		max-block-size: 100%;*/
/*		margin-inline: 8px;*/

/*		& > foreignObject {*/
/*			inline-size: 100%;*/
/*			block-size: 100%;*/

		& > .main {
			/*overflow: auto;*/
			/*display: grid;*/
			/*grid-template-rows: 12px auto 12px;*/
			/*gap: 8px;*/
			/*align-items: stretch;*/
			/*justify-content: center;*/

			/*block-size: 100%;*/
			/*margin-inline: 8px;*/

			& > .aspect-ratio-lock {
/*				!* TODO Add additional 8px spacing between board and timer & board and play mode. *!*/
				& > #board {
					display: contents;

					& > .half {
						display: flex;
						flex-direction: column;
						justify-content: space-between;

						aspect-ratio: var(--half-width-unitless) / var(--half-height-unitless);
						max-inline-size: 100cqi;
						block-size: 100%;
						min-block-size: 0;
						max-block-size: 100cqb;

						background: hotpink;
						background: var(--primary-container);
						clip-path: fill-box inset(0 round .5em);

						& > .quadrant {
							display: flex;

							& > veyndan-point {
								&:nth-child(even) {
									color: hsl(from var(--secondary) h s 50%);
								}

								&:nth-child(odd) {
									color: var(--primary);
								}
							}

							&:last-of-type {
								transform: scale(-1, -1);
							}
						}
					}

					& > .bar {
						aspect-ratio: var(--bar-width-unitless) / var(--half-height-unitless);
						block-size: 100%;
						min-block-size: 0;
						border-radius: .5em;

						background: var(--secondary-container);
					}

					& > #sidebar {
						display: flex;
						align-items: center;
						justify-content: space-evenly;
						writing-mode: sideways-rl;
					}
				}

				& > #controls {
					display: contents;

					& > div {
						z-index: 1;

						display: flex;
						gap: .5em;
						align-items: center;
						justify-content: center;
					}
				}

				& > #checkers {
					pointer-events: none;
					z-index: 2;
					grid-column: 3 / span 3;
					grid-row: 2;
				}

				& > #drop-points {
					pointer-events: none;
					grid-column: 3 / span 3;
					grid-row: 1 / -1;
				}
			}
			}
/*		}*/
/*	}*/
}

/*noinspection CssInvalidFunction*/
.drop-point,
#checkers > *:not([data-hit]) {
	/* Returns 1 if the --point is in [1,12], else 0. */
	--is-bottom-point: calc(1 - var(--is-top-point));
	/* Returns 1 if the --point is in [13,24], else 0. */
	--is-top-point: round(down, calc((var(--point) - 1) / var(--point-per-side)), 1);
	/* Returns 1 if the --point is in [1,6] âˆª [19,24], else 0. */
	--is-right-point: round(down, abs(calc((var(--point-max) + var(--point-min)) / 2) - var(--point)) / 6, 1);
	--translate-x:
		calc(
			var(--is-top-point) * (var(--checker-diameter-length) * rem(var(--point) - 1, var(--point-per-side)))
			+ var(--is-bottom-point) * (2 * var(--half-width-length) - var(--checker-diameter-length) * (rem(var(--point) - 1, var(--point-per-side)) + 1))
			+ var(--is-right-point) * (var(--bar-width-length) + 1em)
		);
}

/*noinspection CssInvalidFunction*/
.drop-point {
	--drop-point-diameter: .75em;

	position: absolute;
	translate:
		calc(
			var(--translate-x) + (var(--checker-diameter-length) - var(--drop-point-diameter)) / 2
		)
		calc(
			var(--is-bottom-point) * (var(--half-height-length) + 1.75em)
		);

	aspect-ratio: 1;
	block-size: var(--drop-point-diameter);
	border-radius: 50%;

	background: darkorange;
}

/*noinspection CssInvalidFunction*/
#checkers > * {
	pointer-events: auto;

	position: absolute;

	display: flex;
	align-items: center;
	justify-content: center;

	transition: translate .3s;

	&:not([data-permissible-destination-points="[]"]) {
		&:hover {
			cursor: pointer;
		}

		&.dragging {
			cursor: move;
			filter: drop-shadow(2px 4px 4px hsl(from var(--surface) h s l / .3));
			transition: filter .3s;
		}
	}

	&[data-permissible-destination-points="[]"]:hover {
		cursor: not-allowed;
	}

	& > text {
		user-select: none;
		dominant-baseline: central;
		text-anchor: middle;
		fill: currentColor;

		/* Hide node from accessibility tree when empty. */
		&:empty {
			display: none;
		}
	}

	&[data-hit] {
		translate: calc(var(--half-width-length) + .5em + (var(--bar-width-length) - var(--checker-diameter-length)) / 2) var(--translate-y);

		&[data-player="1"] {
			--translate-y: calc(var(--checker-diameter-length) * 2.5);
		}

		&[data-player="2"] {
			--translate-y: calc(var(--half-height-length) - var(--checker-diameter-length) * 3.5);
		}
	}

	&:not([data-hit]) {
		--top-point-translate-y: calc(var(--checker-diameter-length) * min(var(--point-stack-index), ((5 - 1) * var(--point-stack-index)) / max(var(--point-stack-count) - 1, 1)));
		--bottom-point-translate-y: calc((var(--half-height-length) - var(--top-point-translate-y) - var(--checker-diameter-length)));

		--top-point-mask-position-vertical: calc(150% + -1 * round(down, calc(var(--point-stack-count) / 6), 1) * (1 - round(down, calc((var(--point-stack-index) + 1) / var(--point-stack-count)), 1)) * (105% - ((4 / max(var(--point-stack-count) - 1, 1)) * 100%)));
		--bottom-point-mask-position-vertical: calc(100% - var(--top-point-mask-position-vertical));

		translate:
			var(--translate-x)
			calc(
				var(--is-top-point) * var(--top-point-translate-y)
				+ var(--is-bottom-point) * var(--bottom-point-translate-y)
			);
		mask-image:
			radial-gradient(
				black var(--checker-radius-length),
				transparent var(--checker-radius-length)
			),
			radial-gradient(
				circle at center calc(var(--is-top-point) * var(--top-point-mask-position-vertical) + var(--is-bottom-point) * var(--bottom-point-mask-position-vertical)),
				black var(--checker-radius-length),
				transparent var(--checker-radius-length)
			);
		mask-composite: subtract;
	}
}

#controls button {
	--surface: var(--player-current-checker-background);
	--color: var(--player-current-checker-text-color);
	--alpha: 1;

	padding-block: calc(10.5em / 16);
	padding-inline: calc(21em / 16);
	border: none;
	border-radius: .5em;

	color: hsl(from var(--color) h s l / var(--alpha));

	background: hsl(from var(--surface) h s l / var(--alpha));

	&:disabled {
		--alpha: .5;
	}

	&:hover:not(:disabled) {
		--alpha: .85;
	}

	&#confirm {
		--surface: hsl(149 83% 28%);
		--color: hsl(0 0% 100%);
	}
}

#dice-container {
	display: none;
	flex-direction: column;
	align-items: center;

	inline-size: 100%;
	margin-block-end: 1em;

	#dice-swap {
		block-size: .75em;
		margin-block: -.0625em;
		visibility: hidden;
	}

	&:has(#dice :not(.rolling):first-child:nth-last-child(2)) {
		cursor: pointer;

		#dice-swap {
			visibility: visible;
		}
	}
}

#dice {
	display: flex;
	justify-content: center;

	margin: 0;
	padding: 0;

	list-style-type: none;

	veyndan-die {
		overflow: hidden;
		flex: 0 1 calc(var(--die-side-length-length) + .875em);
		margin-inline: .125em;

		&:nth-child(n + 3) {
			animation: .5s .2s backwards flex-grow,
				.2s .8125s backwards fade-in;
		}
	}
}

@keyframes fade-in {
	from {
		opacity: 0;
	}
	to {
		opacity: 1;
	}
}

@keyframes flex-grow {
	from {
		flex: 0;
		margin-inline: 0;
	}
	to {
		flex: 0 1 calc(var(--die-side-length-length) + .875em);
	}
}
